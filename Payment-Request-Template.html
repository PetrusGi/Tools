<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betalingsherinnering Template</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Text:ital@0;1&family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary-color: #DC0028;
            --primary-hover: #c00020;
            --secondary-color: #F5F4F8;
            --secondary-hover: #E5E4E8;
            --accent-color: #FFD700;
            --dark-text: #333333;
            --light-text: #666666;
            --lightest-text: #999999;
            --white: #ffffff;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--dark-text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 40px 20px;
        }
        
        .page-wrapper {
            max-width: 960px;
            margin: 0 auto;
        }
        
        .header-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 30px;
        }
        
        .logo {
            width: 100px;
            height: 100px;
            object-fit: contain;
        }
        
        h2 {
            font-family: 'DM Serif Text', serif;
            font-size: 2.8rem;
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            width: 100%;
            text-align: center;
            margin-top: 10px;
            color: var(--light-text);
            font-size: 1.1rem;
        }
        
        .template-container {
            display: flex;
            gap: 30px;
            margin-top: 40px;
            flex-wrap: wrap;
        }
        
        .form-container {
            flex: 1;
            min-width: 300px;
            background-color: var(--white);
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .form-container:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        
        .preview-container {
            flex: 1;
            min-width: 300px;
            background-color: var(--white);
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
        }
        
        .preview-hidden {
            display: none;
        }
        
        .form-title {
            font-family: 'DM Serif Text', serif;
            font-size: 1.6rem;
            margin-bottom: 25px;
            color: var(--dark-text);
            padding-bottom: 10px;
            border-bottom: 1px solid var(--secondary-color);
        }
        
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        label {
            font-weight: 500;
            display: block;
            margin-bottom: 8px;
            font-size: 1rem;
            color: var(--dark-text);
        }
        
        .input-wrapper {
            position: relative;
        }
        
        input[type="text"], 
        input[type="number"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--secondary-color);
            border-radius: 8px;
            font-size: 1.1rem;
            transition: var(--transition);
        }
        
        input[type="text"]:focus, 
        input[type="number"]:focus,
        select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(220, 0, 40, 0.1);
        }
        
        .generate-btn {
            width: 100%;
            padding: 14px;
            background-color: var(--primary-color);
            color: var(--white);
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            margin-top: 30px;
            transition: var(--transition);
        }
        
        .generate-btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
        }
        
        .preview-title {
            font-family: 'DM Serif Text', serif;
            font-size: 1.6rem;
            margin-bottom: 25px;
            color: var(--dark-text);
            padding-bottom: 10px;
            border-bottom: 1px solid var(--secondary-color);
        }
        
        .letter-content {
            white-space: pre-line;
            font-size: 1rem;
            line-height: 1.8;
            margin-bottom: 30px;
        }
        
        .specification {
            background-color: var(--secondary-color);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .invoice-table th, 
        .invoice-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--secondary-color);
        }
        
        .invoice-table th {
            font-weight: 700;
            color: var(--light-text);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .action-btn {
            flex: 1;
            padding: 12px;
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            text-align: center;
            text-decoration: none;
        }
        
        .print-btn {
            background-color: var(--secondary-color);
            color: var(--dark-text);
        }
        
        .print-btn:hover {
            background-color: var(--secondary-hover);
        }
        
        .download-btn {
            background-color: var(--primary-color);
            color: var(--white);
        }
        
        .download-btn:hover {
            background-color: var(--primary-hover);
        }
        
        .input-helper {
            display: block;
            font-size: 0.8rem;
            color: var(--lightest-text);
            margin-top: 5px;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            color: var(--light-text);
            font-size: 0.9rem;
        }
        
        footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
        }
        
        footer a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .template-container {
                flex-direction: column;
            }
            
            .logo-container {
                margin-right: 0;
                margin-bottom: 20px;
            }
            
            .header-wrapper {
                flex-direction: column;
                text-align: center;
            }
            
            h2 {
                font-size: 2.2rem;
            }
        }
        
        .currency-symbol {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--light-text);
            font-weight: 500;
        }
        
        .has-currency input {
            padding-left: 30px;
        }
        
        .invoice-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid var(--secondary-color);
            border-radius: 8px;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background-color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: var(--transition);
            z-index: 1000;
        }
        
        .back-button:hover {
            background-color: var(--primary-hover);
            transform: scale(1.05);
        }
        
        .material-icons {
            font-size: 24px;
        }
    </style>
</head>
<body>
    <!-- Back button with arrow_back icon -->
    <a href="Tools-Dashboard.html" class="back-button">
        <span class="material-icons">arrow_back</span>
    </a>
    
    <div class="page-wrapper">
        <div class="header-wrapper">
            <div class="logo-container">
                <img src="https://www.creditexpo.nl/wp-content/uploads/2024/09/Logo-Credit-IQ-CIQ-no-bg-2048x2048.png" alt="Payment Icon" class="logo">
            </div>
            <h2>Betalingsherinnering Template</h2>
            <p class="subtitle">Genereer vriendelijke herinneringen voor openstaande facturen</p>
        </div>

        <div class="template-container">
            <div class="form-container">
                <h3 class="form-title">Gegevens invoeren</h3>
                
                <div class="form-group">
                    <label for="companyName">Uw bedrijfsnaam</label>
                    <input type="text" id="companyName" placeholder="Bijv. Acme B.V.">
                </div>
                
                <div class="form-group">
                    <label for="location">Uw vestigingsplaats</label>
                    <input type="text" id="location" placeholder="Bijv. Amsterdam">
                </div>
                
                <div class="form-group">
                    <label for="iban">Uw IBAN</label>
                    <input type="text" id="iban" placeholder="Bijv. NL02ABNA0123456789">
                    <span class="input-helper">Voer uw volledige IBAN in zonder spaties</span>
                </div>
                
                <div class="form-group">
                    <label for="days">Betalingstermijn (dagen)</label>
                    <select id="days">
                        <option value="3">3 dagen</option>
                        <option value="5" selected>5 dagen</option>
                        <option value="7">7 dagen</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="invoiceNumbers">Factuurnummer(s)</label>
                    <div class="input-wrapper">
                        <input type="text" id="invoiceInput" placeholder="Voer factuurnummer in">
                    </div>
                    <button id="addInvoiceBtn" class="print-btn action-btn" style="margin-top: 10px;">Toevoegen</button>
                    <div class="invoice-list" id="invoiceList">
                        <!-- Invoices will be added here -->
                    </div>
                    <span class="input-helper">Voeg alle openstaande factuurnummers toe</span>
                </div>
                
                <button class="generate-btn" onclick="generateTemplate()">Genereer Betalingsherinnering</button>
            </div>
            
            <div class="preview-container preview-hidden" id="previewContainer">
                <h3 class="preview-title">Betalingsherinnering Voorbeeld</h3>
                
                <div class="specification" id="specification">
                    Overzicht van openstaande facturen:
                </div>
                
                <div class="letter-content" id="letterContent">
                    Betalingsherinnering betreffende de onderstaande openstaande factu(u)r(en).

                    Volgens onze administratie hebben wij nog geen betaling ontvangen voor de hierboven genoemde factu(u)r(en). Mogelijk is de betaling reeds onderweg of heeft u deze factuur over het hoofd gezien.

                    Wij verzoeken u vriendelijk om het openstaande bedrag binnen [dagen] dagen over te maken op IBAN [iban] ten name van [bedrijfsnaam] te [vestigingsplaats] onder vermelding van het factuurnummer.

                    Mocht u vragen hebben over deze factuur of als er een reden is waarom de betaling is uitgebleven, neem dan gerust contact met ons op. We denken graag met u mee over een passende oplossing.

                    Indien u de betaling inmiddels heeft voldaan, kunt u deze herinnering als niet verzonden beschouwen.

                    Met vriendelijke groet,

                    [bedrijfsnaam]
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn print-btn" onclick="printTemplate()">Afdrukken</button>
                    <button class="action-btn download-btn" onclick="downloadTemplate()">Downloaden als PDF</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Betalingsherinnering Template &copy; 2025 | <a href="#" onclick="resetForm()">Formulier resetten</a></p>
        </footer>
    </div>

    <!-- Add jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script>
        // Add invoice to the list
        document.getElementById('addInvoiceBtn').addEventListener('click', function() {
            const invoiceInput = document.getElementById('invoiceInput');
            const invoice = invoiceInput.value.trim();
            
            if (invoice) {
                const invoiceList = document.getElementById('invoiceList');
                const invoiceItem = document.createElement('div');
                invoiceItem.style.padding = '10px';
                invoiceItem.style.borderBottom = '1px solid #E5E4E8';
                invoiceItem.style.display = 'flex';
                invoiceItem.style.justifyContent = 'space-between';
                
                const invoiceText = document.createElement('span');
                invoiceText.textContent = invoice;
                
                const removeBtn = document.createElement('button');
                removeBtn.textContent = '×';
                removeBtn.style.background = 'none';
                removeBtn.style.border = 'none';
                removeBtn.style.color = '#DC0028';
                removeBtn.style.fontSize = '1.2rem';
                removeBtn.style.cursor = 'pointer';
                removeBtn.onclick = function() {
                    invoiceItem.remove();
                };
                
                invoiceItem.appendChild(invoiceText);
                invoiceItem.appendChild(removeBtn);
                invoiceList.appendChild(invoiceItem);
                
                invoiceInput.value = '';
            }
        });
        
        // Allow Enter key to add invoice
        document.getElementById('invoiceInput').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                document.getElementById('addInvoiceBtn').click();
            }
        });
        
        // Generate the payment request template
        function generateTemplate() {
            const companyName = document.getElementById('companyName').value.trim();
            const location = document.getElementById('location').value.trim();
            const iban = document.getElementById('iban').value.trim();
            const days = document.getElementById('days').value;
            
            // Get all invoices
            const invoiceItems = document.querySelectorAll('#invoiceList > div > span');
            const invoices = Array.from(invoiceItems).map(item => item.textContent);
            
            if (!companyName || !location || !iban || invoices.length === 0) {
                alert("Vul alle vereiste velden in en voeg ten minste één factuurnummer toe.");
                return;
            }
            
            // Update specification
            let specificationText = "Overzicht van openstaande facturen:<br><br>";
            specificationText += "<table class='invoice-table'>";
            specificationText += "<tr><th>Factuurnummer</th></tr>";
            
            invoices.forEach(invoice => {
                specificationText += `<tr><td>${invoice}</td></tr>`;
            });
            
            specificationText += "</table>";
            document.getElementById('specification').innerHTML = specificationText;
            
            // Update letter content
            let letterContent = document.getElementById('letterContent').textContent;
            letterContent = letterContent.replace('[dagen]', days);
            letterContent = letterContent.replace('[iban]', iban);
            letterContent = letterContent.replace('[bedrijfsnaam]', companyName);
            letterContent = letterContent.replace('[vestigingsplaats]', location);
            letterContent = letterContent.replace('[bedrijfsnaam]', companyName);
            
            document.getElementById('letterContent').textContent = letterContent;
            
            // Show preview
            document.getElementById('previewContainer').classList.remove('preview-hidden');
            
            // Scroll to preview
            document.getElementById('previewContainer').scrollIntoView({
                behavior: 'smooth'
            });
        }
        
        // Print the template
        function printTemplate() {
            const content = document.getElementById('previewContainer').innerHTML;
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Betalingsherinnering</title>
                    <style>
                        body {
                            font-family: 'Roboto', Arial, sans-serif;
                            line-height: 1.6;
                            color: #333;
                            padding: 40px;
                        }
                        .preview-title {
                            font-size: 24px;
                            margin-bottom: 20px;
                            border-bottom: 1px solid #eee;
                            padding-bottom: 10px;
                        }
                        .specification {
                            background-color: #f5f5f5;
                            padding: 20px;
                            border-radius: 8px;
                            margin-bottom: 20px;
                        }
                        .letter-content {
                            white-space: pre-line;
                            line-height: 1.8;
                        }
                        .invoice-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }
                        .invoice-table th, 
                        .invoice-table td {
                            padding: 12px;
                            text-align: left;
                            border-bottom: 1px solid #eee;
                        }
                        .action-buttons {
                            display: none;
                        }
                    </style>
                </head>
                <body>
                    ${content}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            
            // Add small delay to ensure content is loaded
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }
        
        // Download as PDF
        function downloadTemplate() {
            // Create a clone of the preview container to modify for PDF
            const previewClone = document.getElementById('previewContainer').cloneNode(true);
            
            // Remove action buttons from the clone
            const actionButtons = previewClone.querySelector('.action-buttons');
            if (actionButtons) {
                previewClone.removeChild(actionButtons);
            }
            
            // Create a temporary container for the PDF content
            const tempContainer = document.createElement('div');
            tempContainer.appendChild(previewClone);
            tempContainer.style.width = '210mm'; // A4 width
            tempContainer.style.padding = '20mm';
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            document.body.appendChild(tempContainer);
            
            // Use html2canvas to capture the content
            html2canvas(previewClone, {
                scale: 2, // Higher scale for better quality
                useCORS: true,
                logging: false
            }).then(canvas => {
                // Remove the temporary container
                document.body.removeChild(tempContainer);
                
                // Initialize jsPDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // Calculate dimensions to fit the canvas to A4
                const imgWidth = 210 - 40; // A4 width minus margins
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                // Add the canvas as an image to the PDF
                const imgData = canvas.toDataURL('image/png');
                pdf.addImage(imgData, 'PNG', 20, 20, imgWidth, imgHeight);
                
                // Get company name for the filename
                const companyName = document.getElementById('companyName').value.trim() || 'Betalingsherinnering';
                const fileName = `${companyName.replace(/\s+/g, '-')}-Betalingsherinnering.pdf`;
                
                // Save the PDF
                pdf.save(fileName);
            }).catch(error => {
                console.error('Error generating PDF:', error);
                alert('Er is een fout opgetreden bij het genereren van de PDF. Probeer het opnieuw.');
            });
        }
        
        // Reset the form
        function resetForm() {
            document.getElementById('companyName').value = '';
            document.getElementById('location').value = '';
            document.getElementById('iban').value = '';
            document.getElementById('days').value = '5';
            document.getElementById('invoiceInput').value = '';
            document.getElementById('invoiceList').innerHTML = '';
            document.getElementById('previewContainer').classList.add('preview-hidden');
        }
    </script>
</body>
</html>
